{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "description": "The AWS::AppRunner::Service resource specifies an AppRunner Service.",
  "definitions": {
    "SourceConfiguration": {
      "description": "Source Code configuration",
      "type": "object",
      "properties": {
        "CodeRepository": {
          "$ref": "#/definitions/CodeRepository"
        },
        "ImageRepository": {
          "$ref": "#/definitions/ImageRepository"
        },
        "AutoDeploymentsEnabled": {
          "description": "Auto Deployment enabled",
          "type": "boolean"
        },
        "AuthenticationConfiguration": {
          "$ref": "#/definitions/AuthenticationConfiguration"
        }
      },
      "additionalProperties": false
    },
    "CodeRepository": {
      "description": "Source Code Repository",
      "type": "object",
      "properties": {
        "RepositoryUrl": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Repository Url"
        },
        "SourceCodeVersion": {
          "$ref": "#/definitions/SourceCodeVersion"
        },
        "CodeConfiguration": {
          "$ref": "#/definitions/CodeConfiguration"
        },
        "SourceDirectory": {
          "oneOf": [
            {
              "type": "string",
              "minLength": 1,
              "maxLength": 4096,
              "pattern": "[^\\x00]+"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Source Directory"
        }
      },
      "required": [
        "RepositoryUrl",
        "SourceCodeVersion"
      ],
      "additionalProperties": false
    },
    "SourceCodeVersion": {
      "description": "Source Code Version",
      "type": "object",
      "properties": {
        "Type": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "BRANCH"
              ]
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Source Code Version Type"
        },
        "Value": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Source Code Version Value"
        }
      },
      "required": [
        "Type",
        "Value"
      ],
      "additionalProperties": false
    },
    "CodeConfiguration": {
      "description": "Code Configuration",
      "type": "object",
      "properties": {
        "ConfigurationSource": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "REPOSITORY",
                "API"
              ]
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Configuration Source"
        },
        "CodeConfigurationValues": {
          "$ref": "#/definitions/CodeConfigurationValues"
        }
      },
      "required": [
        "ConfigurationSource"
      ],
      "additionalProperties": false
    },
    "CodeConfigurationValues": {
      "description": "Code Configuration Values",
      "type": "object",
      "properties": {
        "Runtime": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "PYTHON_3",
                "NODEJS_12",
                "NODEJS_14",
                "CORRETTO_8",
                "CORRETTO_11",
                "NODEJS_16",
                "GO_1",
                "DOTNET_6",
                "PHP_81",
                "RUBY_31",
                "PYTHON_311",
                "NODEJS_18"
              ]
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Runtime"
        },
        "BuildCommand": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Build Command"
        },
        "StartCommand": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Start Command"
        },
        "Port": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Port"
        },
        "RuntimeEnvironmentVariables": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/KeyValuePair"
          }
        },
        "RuntimeEnvironmentSecrets": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/KeyValuePair"
          },
          "description": "The secrets and parameters that get referenced by your service as environment variables"
        }
      },
      "required": [
        "Runtime"
      ],
      "additionalProperties": false
    },
    "ImageRepository": {
      "description": "Image Repository",
      "type": "object",
      "properties": {
        "ImageIdentifier": {
          "oneOf": [
            {
              "type": "string",
              "minLength": 1,
              "maxLength": 1024,
              "pattern": "([0-9]{12}.dkr.ecr.[a-z\\-]+-[0-9]{1}.amazonaws.com\\/.*)|(^public\\.ecr\\.aws\\/.+\\/.+)"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Image Identifier"
        },
        "ImageConfiguration": {
          "$ref": "#/definitions/ImageConfiguration"
        },
        "ImageRepositoryType": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "ECR",
                "ECR_PUBLIC"
              ]
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Image Repository Type"
        }
      },
      "required": [
        "ImageIdentifier",
        "ImageRepositoryType"
      ],
      "additionalProperties": false
    },
    "ImageConfiguration": {
      "description": "Image Configuration",
      "type": "object",
      "properties": {
        "StartCommand": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Start Command"
        },
        "Port": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Port"
        },
        "RuntimeEnvironmentVariables": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/KeyValuePair"
          }
        },
        "RuntimeEnvironmentSecrets": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/KeyValuePair"
          },
          "description": "The secrets and parameters that get referenced by your service as environment variables"
        }
      },
      "additionalProperties": false
    },
    "AuthenticationConfiguration": {
      "description": "Authentication Configuration",
      "type": "object",
      "properties": {
        "ConnectionArn": {
          "oneOf": [
            {
              "type": "string",
              "minLength": 1,
              "maxLength": 1011,
              "pattern": "arn:aws(-[\\w]+)*:[a-z0-9-\\\\.]{0,63}:[a-z0-9-\\\\.]{0,63}:[0-9]{12}:(\\w|\\/|-){1,1011}"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Connection Arn"
        },
        "AccessRoleArn": {
          "description": "Access Role Arn",
          "$ref": "#/definitions/RoleArn"
        }
      },
      "additionalProperties": false
    },
    "InstanceConfiguration": {
      "description": "Instance Configuration",
      "type": "object",
      "properties": {
        "Cpu": {
          "oneOf": [
            {
              "type": "string",
              "minLength": 3,
              "maxLength": 9,
              "pattern": "256|512|1024|2048|4096|(0.25|0.5|1|2|4) vCPU"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "CPU"
        },
        "Memory": {
          "oneOf": [
            {
              "type": "string",
              "minLength": 3,
              "maxLength": 6,
              "pattern": "512|1024|2048|3072|4096|6144|8192|10240|12288|(0.5|1|2|3|4|6|8|10|12) GB"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Memory"
        },
        "InstanceRoleArn": {
          "description": "Instance Role Arn",
          "$ref": "#/definitions/RoleArn"
        }
      },
      "additionalProperties": false
    },
    "RoleArn": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 29,
          "maxLength": 1024,
          "pattern": "arn:(aws|aws-us-gov|aws-cn|aws-iso|aws-iso-b):iam::[0-9]{12}:role/[\\w+=,.@-]{1,64}"
        },
        {
          "$ref": "../component/functions.json#/AwsFunctionString"
        }
      ]
    },
    "EncryptionConfiguration": {
      "description": "Encryption configuration (KMS key)",
      "type": "object",
      "properties": {
        "KmsKey": {
          "oneOf": [
            {
              "type": "string",
              "minLength": 0,
              "maxLength": 256,
              "pattern": "arn:aws(-[\\w]+)*:kms:[a-z\\-]+-[0-9]{1}:[0-9]{12}:key\\/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "The KMS Key"
        }
      },
      "required": [
        "KmsKey"
      ],
      "additionalProperties": false
    },
    "HealthCheckConfiguration": {
      "description": "Health check configuration",
      "type": "object",
      "properties": {
        "Protocol": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "TCP",
                "HTTP"
              ]
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Health Check Protocol"
        },
        "Path": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Health check Path"
        },
        "Interval": {
          "type": "integer",
          "description": "Health check Interval"
        },
        "Timeout": {
          "type": "integer",
          "description": "Health check Timeout",
          "minimum": 1,
          "maximum": 20
        },
        "HealthyThreshold": {
          "type": "integer",
          "description": "Health check Healthy Threshold",
          "minimum": 1,
          "maximum": 20
        },
        "UnhealthyThreshold": {
          "type": "integer",
          "description": "Health check Unhealthy Threshold",
          "minimum": 1,
          "maximum": 20
        }
      },
      "additionalProperties": false
    },
    "EgressConfiguration": {
      "description": "Network egress configuration",
      "type": "object",
      "properties": {
        "EgressType": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "DEFAULT",
                "VPC"
              ]
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "Network egress type."
        },
        "VpcConnectorArn": {
          "oneOf": [
            {
              "type": "string",
              "minLength": 44,
              "maxLength": 1011,
              "pattern": "arn:aws(-[\\w]+)*:[a-z0-9-\\\\.]{0,63}:[a-z0-9-\\\\.]{0,63}:[0-9]{12}:(\\w|\\/|-){1,1011}"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "The Amazon Resource Name (ARN) of the App Runner VpcConnector."
        }
      },
      "required": [
        "EgressType"
      ],
      "additionalProperties": false
    },
    "IngressConfiguration": {
      "description": "Network ingress configuration",
      "type": "object",
      "properties": {
        "IsPubliclyAccessible": {
          "description": "It's set to true if the Apprunner service is publicly accessible. It's set to false otherwise.",
          "type": "boolean"
        }
      },
      "required": [
        "IsPubliclyAccessible"
      ],
      "additionalProperties": false
    },
    "NetworkConfiguration": {
      "description": "Network configuration",
      "type": "object",
      "properties": {
        "EgressConfiguration": {
          "$ref": "#/definitions/EgressConfiguration"
        },
        "IngressConfiguration": {
          "$ref": "#/definitions/IngressConfiguration"
        },
        "IpAddressType": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "IPV4",
                "DUAL_STACK"
              ]
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "App Runner service endpoint IP address type"
        }
      },
      "additionalProperties": false
    },
    "ServiceObservabilityConfiguration": {
      "description": "Service observability configuration",
      "type": "object",
      "properties": {
        "ObservabilityEnabled": {
          "description": "Observability enabled",
          "type": "boolean"
        },
        "ObservabilityConfigurationArn": {
          "oneOf": [
            {
              "type": "string",
              "minLength": 1,
              "maxLength": 1011,
              "pattern": "arn:aws(-[\\w]+)*:[a-z0-9-\\.]{0,63}:[a-z0-9-\\.]{0,63}:[0-9]{12}:(\\w|/|-){1,1011}"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ],
          "description": "The Amazon Resource Name (ARN) of the App Runner ObservabilityConfiguration."
        }
      },
      "required": [
        "ObservabilityEnabled"
      ],
      "additionalProperties": false
    },
    "Tag": {
      "type": "object",
      "properties": {
        "Key": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ]
        },
        "Value": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "KeyValuePair": {
      "type": "object",
      "properties": {
        "Name": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ]
        },
        "Value": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "../component/functions.json#/AwsFunctionString"
            }
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "properties": {
    "ServiceName": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 4,
          "maxLength": 40,
          "pattern": "[A-Za-z0-9][A-Za-z0-9-_]{3,39}"
        },
        {
          "$ref": "../component/functions.json#/AwsFunctionString"
        }
      ],
      "description": "The AppRunner Service Name."
    },
    "ServiceId": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 32,
          "maxLength": 32
        },
        {
          "$ref": "../component/functions.json#/AwsFunctionString"
        }
      ],
      "description": "The AppRunner Service Id"
    },
    "ServiceArn": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 1,
          "maxLength": 1011,
          "pattern": "arn:aws(-[\\w]+)*:[a-z0-9-\\\\.]{0,63}:[a-z0-9-\\\\.]{0,63}:[0-9]{12}:(\\w|\\/|-){1,1011}"
        },
        {
          "$ref": "../component/functions.json#/AwsFunctionString"
        }
      ],
      "description": "The Amazon Resource Name (ARN) of the AppRunner Service."
    },
    "ServiceUrl": {
      "oneOf": [
        {
          "type": "string"
        },
        {
          "$ref": "../component/functions.json#/AwsFunctionString"
        }
      ],
      "description": "The Service Url of the AppRunner Service."
    },
    "Status": {
      "oneOf": [
        {
          "type": "string"
        },
        {
          "$ref": "../component/functions.json#/AwsFunctionString"
        }
      ],
      "description": "AppRunner Service status."
    },
    "SourceConfiguration": {
      "$ref": "#/definitions/SourceConfiguration"
    },
    "InstanceConfiguration": {
      "$ref": "#/definitions/InstanceConfiguration"
    },
    "Tags": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Tag"
      }
    },
    "EncryptionConfiguration": {
      "$ref": "#/definitions/EncryptionConfiguration"
    },
    "HealthCheckConfiguration": {
      "$ref": "#/definitions/HealthCheckConfiguration"
    },
    "ObservabilityConfiguration": {
      "$ref": "#/definitions/ServiceObservabilityConfiguration"
    },
    "AutoScalingConfigurationArn": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 1,
          "maxLength": 1011,
          "pattern": "arn:aws(-[\\w]+)*:[a-z0-9-\\\\.]{0,63}:[a-z0-9-\\\\.]{0,63}:[0-9]{12}:(\\w|\\/|-){1,1011}"
        },
        {
          "$ref": "../component/functions.json#/AwsFunctionString"
        }
      ],
      "description": "Autoscaling configuration ARN"
    },
    "NetworkConfiguration": {
      "$ref": "#/definitions/NetworkConfiguration"
    }
  },
  "required": [
    "SourceConfiguration"
  ],
  "additionalProperties": false
}