{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "title": "Serverless Framework Configuration",
  "description": "Schema for serverless framework configuration files",
  "fileMatch": [
    "serverless.yml",
    "serverless.yaml"
  ],
  "definitions": {
    "ServerlessProvider": {
      "type": "object",
      "description": "Configuration for Serverless Provider",
      "properties": {
        "name": {
          "description": "Provider name",
          "default": "aws",
          "enum": [
            "aws",
            "azure",
            "google",
            "knative",
            "aliyun",
            "fn",
            "kubeless",
            "openwhisk",
            "tencent",
            "cloudflare"
          ]
        }
      },
      "anyOf": [
        {
          "if": {
            "properties": {
              "name": {
                "const": "aws"
              }
            }
          },
          "then": {
            "$ref": "provider/aws/provider.json"
          }
        }
      ],
      "required": [
        "name"
      ]
    },
    "ServerlessResources": {
      "oneOf": [
        {
          "type": "object",
          "description": "Serverless Framework Additional Resources Configuration",
          "anyOf": [
            {
              "if": {
                "provider": {
                  "name": {
                    "const": "aws"
                  }
                }
              },
              "then": {
                "properties": {
                  "Outputs": {
                    "$ref": "provider/aws/component/outputs.json#/AwsOutputs"
                  },
                  "Resources": {
                    "$ref": "provider/aws/resources.json#/AwsResources"
                  },
                  "Mappings": {
                    "description": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/mappings-section-structure.html",
                    "type": "object",
                    "patternProperties": {
                      "^[a-zA-Z0-9._-]{1,255}$": {
                        "$ref": "provider/aws/component/mappings.json#/properties/Mappings"
                      }
                    },
                    "additionalProperties": false
                  },
                  "Conditions": {
                    "description": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/conditions-section-structure.html",
                    "$ref": "provider/aws/component/conditions.json#/properties/Conditions"
                  },
                  "Parameters": {
                    "description": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html",
                    "$ref": "provider/aws/component/parameters.json#/properties/Parameters"
                  },
                  "Hooks": {
                    "description": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/blue-green.html",
                    "type": "object"
                  },
                  "Rules": {
                    "description": "https://docs.aws.amazon.com/servicecatalog/latest/adminguide/reference-template_constraint_rules.html",
                    "type": "object"
                  },
                  "AWSTemplateFormatVersion": {
                    "description": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/format-version-structure.html",
                    "default": "2010-09-09",
                    "enum": [
                      "2010-09-09"
                    ]
                  },
                  "Description": {
                    "description": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-description-structure.html",
                    "type": "string",
                    "maxLength": 1024
                  },
                  "Metadata": {
                    "description": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/metadata-section-structure.html",
                    "type": "object"
                  },
                  "Transform": {
                    "description": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/transform-section-structure.html",
                    "type": "object",
                    "oneOf": [
                      {
                        "$comment": "You can use the AWS::Include transform anywhere within the AWS CloudFormation template except in the template parameters section or the template version field. For example, you can use AWS::Include in the mappings section.",
                        "properties": {
                          "Name": {
                            "type": "string",
                            "enum": [
                              "AWS::Include"
                            ]
                          },
                          "Parameters": {
                            "type": "object",
                            "properties": {
                              "Location": {
                                "$comment": "The location is an Amazon S3 URI, with a specific file name in an S3 bucket. For example, s3://MyBucketName/MyFile.yaml.",
                                "type": "string",
                                "format": "uri"
                              }
                            },
                            "additionalProperties": false
                          }
                        },
                        "additionalProperties": false
                      },
                      {
                        "$comment": "Use a transform to simplify template authoring for serverless applications.",
                        "type": "string",
                        "enum": [
                          "AWS::CodeDeployBlueGreen",
                          "AWS::CodeStar",
                          "AWS::SecretsManager-2020-07-23",
                          "AWS::Serverless-2016-10-31"
                        ]
                      }
                    ]
                  }
                }
              }
            }
          ]
        },
        {
          "$ref": "#/definitions/ServerlessFilePath"
        }
      ]
    },
    "ServerlessCustom": {
      "type": "object",
      "properties": {
        "esbuild": {
          "$ref": "plugin/custom/esbuild.json#/Esbuild"
        },
        "prune": {
          "$ref": "plugin/custom/prune.json#/Prune"
        },
        "pythonRequirements": {
          "$ref": "plugin/custom/python.requirements.json#/PythonRequirements"
        },
        "wsgi": {
          "$ref": "plugin/custom/python.wsgi.json#/PythonWSGI"
        },
        "splitStacks": {
          "$ref": "plugin/custom/split.stacks.json#/SplitStacks"
        },
        "ssmPublish": {
          "$ref": "plugin/custom/ssm.publish.json#/SsmPublishConfiguration"
        },
        "webpack": {
          "$ref": "plugin/custom/webpack.json#/WebpackConfiguration"
        }
      }
    },
    "ServerlessFilePath": {
      "type": "string",
      "minLength": 1,
      "pattern": "\\$\\{file\\(.+\\.(yml|yaml)\\)(:[A-Za-z]+)?(\\s*,\\s*(\"[^,]*\"|'[^,]*'|[A-Za-z:._-]+)\\s*)?\\}"
    }
  },
  "properties": {
    "service": {
      "description": "Serverless service name",
      "properties": {
        "name": {
          "type": "string"
        }
      }
    },
    "frameworkVersion": {
      "description": "Framework version constraint (semver constraint): '3', '^2.33'",
      "type": "string"
    },
    "configValidationMode": {
      "description": "Configuration validation: 'error' (fatal error), 'warn' (logged to the output) or 'off' (default: warn)",
      "default": "warn",
      "enum": [
        "error",
        "warn",
        "off"
      ]
    },
    "useDotenv": {
      "description": "Load environment variables from .env files (default: false)",
      "default": false,
      "type": "boolean"
    },
    "deprecationNotificationMode": {
      "description": "'warn' reports deprecations on the go, 'error' will result with an exception being thrown on first approached deprecation",
      "type": "string"
    },
    "disabledDeprecations": {
      "description": "",
      "items": {
        "type": "string"
      },
      "type": "array"
    },
    "provider": {
      "$ref": "#/definitions/ServerlessProvider"
    },
    "custom": {
      "$ref": "#/definitions/ServerlessCustom"
    },
    "plugins": {
      "description": "Custom JavaScript codes that extends the Serverless Framework with new features",
      "oneOf": [
        {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        {
          "type": "object",
          "properties": {
            "localPath": {
              "description": "The path to the local .js file that contains the plugin",
              "type": "string"
            },
            "modules": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      ]
    }
  },
  "anyOf": [
    {
      "if": {
        "provider": {
          "name": {
            "const": "aws"
          }
        }
      },
      "then": {
        "properties": {
          "functions": {
            "oneOf": [
              {
                "patternProperties": {
                  "^[a-zA-Z0-9]{1,255}$": {
                    "$ref": "provider/aws/provider.json#/definitions/AwsFunction"
                  }
                }
              },
              {
                "type": "array",
                "items": {
                  "$ref": "#/definitions/ServerlessFilePath"
                }
              }
            ]
          },
          "stepFunctions": {
            "$ref": "provider/aws/plugin/step.functions.json#/AwsStepFunctions"
          },
          "resources": {
            "$ref": "#/definitions/ServerlessResources"
          }
        }
      }
    }
  ],
  "type": "object",
  "required": [
    "service",
    "provider"
  ]
}